CREATE OR REPLACE FUNCTION parseAndUpdate()  RETURNS void AS $$  DECLARE 
 rowcount INTEGER;  
 myrecord RECORD;  
 skipscans BOOLEAN;  
 BEGIN 
 
PERFORM * FROM das.observation where observation_no =8534 and proj_code='30_032' ; 
 GET DIAGNOSTICS rowcount = ROW_COUNT ; 
 if(rowcount=0) then 
 INSERT INTO das.observation(observation_no, proj_code)VALUES (8534, '30_032');
INSERT INTO das.log(observation_no, logfile )VALUES (8534, '/home/ratnakumar/backups/ncranas_home_bkup/30_032/8534.obslog');
 end if; 

skipscans := FALSE;
PERFORM * FROM das.scangroup WHERE observation_no = 8534 AND lta_file = '30_032_26apr2016.lta' AND file_path = '/home/ratnakumar/backups/ncranas_home_bkup/30_032/' ; 
GET DIAGNOSTICS rowcount = ROW_COUNT; 
if(rowcount <> 0) then 
   RAISE NOTICE '8534 - /home/ratnakumar/backups/ncranas_home_bkup/30_032//30_032_26apr2016.lta being skipped' ; 
   skipscans := TRUE;
else 
PERFORM lta_file, ltb_file, lta_gsb_file FROM das.scangroup where observation_no = 8534 and (ltb_file='30_032_26apr2016.ltb' or lta_gsb_file='30_032_26apr2016_gsb.lta') and file_path='/home/ratnakumar/backups/ncranas_home_bkup/30_032/'; 
 GET DIAGNOSTICS rowcount = ROW_COUNT ; 
 if(rowcount=0) then 
 INSERT INTO das.scangroup(observation_no,lta_file,  ltb_file, lta_gsb_file, corr_version, sta_time, num_pols, num_chans, lta_time, file_path , lta_file_size) VALUES (8534,  '30_032_26apr2016.lta' , '', '', 'COR30x2 LTA1.10 DAS1.10 HST03 ',  251658, 2, 512, 64 , '/home/ratnakumar/backups/ncranas_home_bkup/30_032/' , 6118.233986);  
 else 
 UPDATE das.scangroup set lta_file='30_032_26apr2016.lta', lta_file_size=6118.233986 where observation_no =8534 and (ltb_file='30_032_26apr2016.ltb' or lta_gsb_file='30_032_26apr2016_gsb.lta') and file_path='/home/ratnakumar/backups/ncranas_home_bkup/30_032/'; 
 end if; 
 
end if;



IF (skipscans = false) then 
INSERT INTO das.scans( observation_no, scangroup_id, scan_no, proj_code, source, ra_2000, dec_2000, date_obs, ant_mask, band_mask, calcode, qual, ra_date, dec_date, dra, ddec, sky_freq1, sky_freq2, rest_freq1, rest_freq2, lsr_vel1, lsr_vel2, chan_width, net_sign1, net_sign2, net_sign3, net_sign4, onsrc_time,source_position)VALUES ( 8534, (select scangroup_id from das.scangroup where lta_file='30_032_26apr2016.lta' and observation_no=8534 and file_path='/home/ratnakumar/backups/ncranas_home_bkup/30_032/'), 0, '30_032', TRIM('3C147       '), 1.494885, 0.870082, 'Tue Apr 26 00:00:02 2016', 1073741823, 3, 0,0, 1.500408, 0.870197, 0.000000, 0.000000, 571935233.000000, 571935233.000000, 0.000000, 0.000000, 0.000000, 0.000000, 4069.010254, -1, -1, 1, 1, 579.820032,spoint(1.494885,0.870082)); 
INSERT INTO das.scans( observation_no, scangroup_id, scan_no, proj_code, source, ra_2000, dec_2000, date_obs, ant_mask, band_mask, calcode, qual, ra_date, dec_date, dra, ddec, sky_freq1, sky_freq2, rest_freq1, rest_freq2, lsr_vel1, lsr_vel2, chan_width, net_sign1, net_sign2, net_sign3, net_sign4, onsrc_time,source_position)VALUES ( 8534, (select scangroup_id from das.scangroup where lta_file='30_032_26apr2016.lta' and observation_no=8534 and file_path='/home/ratnakumar/backups/ncranas_home_bkup/30_032/'), 1, '30_032', TRIM('1400+621    '), 3.667275, 1.0852, 'Tue Apr 26 00:00:02 2016', 1073741823, 3, 0,0, 3.669416, 1.083829, 0.000000, 0.000000, 571935233.000000, 571935233.000000, 0.000000, 0.000000, 0.000000, 0.000000, 4069.010254, -1, -1, 1, 1, 402.652800,spoint(3.667275,1.085200)); 
INSERT INTO das.scans( observation_no, scangroup_id, scan_no, proj_code, source, ra_2000, dec_2000, date_obs, ant_mask, band_mask, calcode, qual, ra_date, dec_date, dra, ddec, sky_freq1, sky_freq2, rest_freq1, rest_freq2, lsr_vel1, lsr_vel2, chan_width, net_sign1, net_sign2, net_sign3, net_sign4, onsrc_time,source_position)VALUES ( 8534, (select scangroup_id from das.scangroup where lta_file='30_032_26apr2016.lta' and observation_no=8534 and file_path='/home/ratnakumar/backups/ncranas_home_bkup/30_032/'), 2, '30_032', TRIM('J1342+5110  '), 3.58842, 0.893087, 'Tue Apr 26 00:00:02 2016', 1073741823, 3, 0,0, 3.591216, 0.891658, 0.000000, 0.000000, 571935233.000000, 571935233.000000, 0.000000, 0.000000, 0.000000, 0.000000, 4069.010254, -1, -1, 1, 1, 2882.994048,spoint(3.588420,0.893087)); 
INSERT INTO das.scans( observation_no, scangroup_id, scan_no, proj_code, source, ra_2000, dec_2000, date_obs, ant_mask, band_mask, calcode, qual, ra_date, dec_date, dra, ddec, sky_freq1, sky_freq2, rest_freq1, rest_freq2, lsr_vel1, lsr_vel2, chan_width, net_sign1, net_sign2, net_sign3, net_sign4, onsrc_time,source_position)VALUES ( 8534, (select scangroup_id from das.scangroup where lta_file='30_032_26apr2016.lta' and observation_no=8534 and file_path='/home/ratnakumar/backups/ncranas_home_bkup/30_032/'), 3, '30_032', TRIM('1400+621    '), 3.667275, 1.0852, 'Tue Apr 26 00:00:02 2016', 1073741823, 3, 0,0, 3.669416, 1.083829, 0.000000, 0.000000, 571935233.000000, 571935233.000000, 0.000000, 0.000000, 0.000000, 0.000000, 4069.010254, -1, -1, 1, 1, 402.652800,spoint(3.667275,1.085200)); 
INSERT INTO das.scans( observation_no, scangroup_id, scan_no, proj_code, source, ra_2000, dec_2000, date_obs, ant_mask, band_mask, calcode, qual, ra_date, dec_date, dra, ddec, sky_freq1, sky_freq2, rest_freq1, rest_freq2, lsr_vel1, lsr_vel2, chan_width, net_sign1, net_sign2, net_sign3, net_sign4, onsrc_time,source_position)VALUES ( 8534, (select scangroup_id from das.scangroup where lta_file='30_032_26apr2016.lta' and observation_no=8534 and file_path='/home/ratnakumar/backups/ncranas_home_bkup/30_032/'), 4, '30_032', TRIM('J1342+5110  '), 3.58842, 0.893087, 'Tue Apr 26 00:00:02 2016', 1073741823, 3, 0,0, 3.591216, 0.891658, 0.000000, 0.000000, 571935233.000000, 571935233.000000, 0.000000, 0.000000, 0.000000, 0.000000, 4069.010254, -1, -1, 1, 1, 2882.994048,spoint(3.588420,0.893087)); 
INSERT INTO das.scans( observation_no, scangroup_id, scan_no, proj_code, source, ra_2000, dec_2000, date_obs, ant_mask, band_mask, calcode, qual, ra_date, dec_date, dra, ddec, sky_freq1, sky_freq2, rest_freq1, rest_freq2, lsr_vel1, lsr_vel2, chan_width, net_sign1, net_sign2, net_sign3, net_sign4, onsrc_time,source_position)VALUES ( 8534, (select scangroup_id from das.scangroup where lta_file='30_032_26apr2016.lta' and observation_no=8534 and file_path='/home/ratnakumar/backups/ncranas_home_bkup/30_032/'), 5, '30_032', TRIM('1400+621    '), 3.667275, 1.0852, 'Tue Apr 26 00:00:02 2016', 1073741823, 3, 0,0, 3.669416, 1.083829, 0.000000, 0.000000, 571935233.000000, 571935233.000000, 0.000000, 0.000000, 0.000000, 0.000000, 4069.010254, -1, -1, 1, 1, 402.652800,spoint(3.667275,1.085200)); 
INSERT INTO das.scans( observation_no, scangroup_id, scan_no, proj_code, source, ra_2000, dec_2000, date_obs, ant_mask, band_mask, calcode, qual, ra_date, dec_date, dra, ddec, sky_freq1, sky_freq2, rest_freq1, rest_freq2, lsr_vel1, lsr_vel2, chan_width, net_sign1, net_sign2, net_sign3, net_sign4, onsrc_time,source_position)VALUES ( 8534, (select scangroup_id from das.scangroup where lta_file='30_032_26apr2016.lta' and observation_no=8534 and file_path='/home/ratnakumar/backups/ncranas_home_bkup/30_032/'), 6, '30_032', TRIM('J1342+5110  '), 3.58842, 0.893087, 'Tue Apr 26 00:00:02 2016', 1073741823, 3, 0,0, 3.591216, 0.891658, 0.000000, 0.000000, 571935233.000000, 571935233.000000, 0.000000, 0.000000, 0.000000, 0.000000, 4069.010254, -1, -1, 1, 1, 2866.887936,spoint(3.588420,0.893087)); 
INSERT INTO das.scans( observation_no, scangroup_id, scan_no, proj_code, source, ra_2000, dec_2000, date_obs, ant_mask, band_mask, calcode, qual, ra_date, dec_date, dra, ddec, sky_freq1, sky_freq2, rest_freq1, rest_freq2, lsr_vel1, lsr_vel2, chan_width, net_sign1, net_sign2, net_sign3, net_sign4, onsrc_time,source_position)VALUES ( 8534, (select scangroup_id from das.scangroup where lta_file='30_032_26apr2016.lta' and observation_no=8534 and file_path='/home/ratnakumar/backups/ncranas_home_bkup/30_032/'), 7, '30_032', TRIM('1400+621    '), 3.667275, 1.0852, 'Tue Apr 26 00:00:02 2016', 1073741823, 3, 0,0, 3.669416, 1.083829, 0.000000, 0.000000, 571935233.000000, 571935233.000000, 0.000000, 0.000000, 0.000000, 0.000000, 4069.010254, -1, -1, 1, 1, 402.652800,spoint(3.667275,1.085200)); 
INSERT INTO das.scans( observation_no, scangroup_id, scan_no, proj_code, source, ra_2000, dec_2000, date_obs, ant_mask, band_mask, calcode, qual, ra_date, dec_date, dra, ddec, sky_freq1, sky_freq2, rest_freq1, rest_freq2, lsr_vel1, lsr_vel2, chan_width, net_sign1, net_sign2, net_sign3, net_sign4, onsrc_time,source_position)VALUES ( 8534, (select scangroup_id from das.scangroup where lta_file='30_032_26apr2016.lta' and observation_no=8534 and file_path='/home/ratnakumar/backups/ncranas_home_bkup/30_032/'), 8, '30_032', TRIM('J1342+5110  '), 3.58842, 0.893087, 'Tue Apr 26 00:00:02 2016', 1073741823, 3, 0,0, 3.591216, 0.891658, 0.000000, 0.000000, 571935233.000000, 571935233.000000, 0.000000, 0.000000, 0.000000, 0.000000, 4069.010254, -1, -1, 1, 1, 2866.887936,spoint(3.588420,0.893087)); 
INSERT INTO das.scans( observation_no, scangroup_id, scan_no, proj_code, source, ra_2000, dec_2000, date_obs, ant_mask, band_mask, calcode, qual, ra_date, dec_date, dra, ddec, sky_freq1, sky_freq2, rest_freq1, rest_freq2, lsr_vel1, lsr_vel2, chan_width, net_sign1, net_sign2, net_sign3, net_sign4, onsrc_time,source_position)VALUES ( 8534, (select scangroup_id from das.scangroup where lta_file='30_032_26apr2016.lta' and observation_no=8534 and file_path='/home/ratnakumar/backups/ncranas_home_bkup/30_032/'), 9, '30_032', TRIM('1400+621    '), 3.667275, 1.0852, 'Tue Apr 26 00:00:02 2016', 1073741823, 3, 0,0, 3.669416, 1.083829, 0.000000, 0.000000, 571935233.000000, 571935233.000000, 0.000000, 0.000000, 0.000000, 0.000000, 4069.010254, -1, -1, 1, 1, 434.865024,spoint(3.667275,1.085200)); 
INSERT INTO das.scans( observation_no, scangroup_id, scan_no, proj_code, source, ra_2000, dec_2000, date_obs, ant_mask, band_mask, calcode, qual, ra_date, dec_date, dra, ddec, sky_freq1, sky_freq2, rest_freq1, rest_freq2, lsr_vel1, lsr_vel2, chan_width, net_sign1, net_sign2, net_sign3, net_sign4, onsrc_time,source_position)VALUES ( 8534, (select scangroup_id from das.scangroup where lta_file='30_032_26apr2016.lta' and observation_no=8534 and file_path='/home/ratnakumar/backups/ncranas_home_bkup/30_032/'), 10, '30_032', TRIM('3C286       '), 3.539258, 0.532485, 'Tue Apr 26 00:00:02 2016', 1073741823, 3, 0,0, 3.542544, 0.531024, 0.000000, 0.000000, 571935233.000000, 571935233.000000, 0.000000, 0.000000, 0.000000, 0.000000, 4069.010254, -1, -1, 1, 1, 579.820032,spoint(3.539258,0.532485)); 
INSERT INTO das.scans( observation_no, scangroup_id, scan_no, proj_code, source, ra_2000, dec_2000, date_obs, ant_mask, band_mask, calcode, qual, ra_date, dec_date, dra, ddec, sky_freq1, sky_freq2, rest_freq1, rest_freq2, lsr_vel1, lsr_vel2, chan_width, net_sign1, net_sign2, net_sign3, net_sign4, onsrc_time,source_position)VALUES ( 8534, (select scangroup_id from das.scangroup where lta_file='30_032_26apr2016.lta' and observation_no=8534 and file_path='/home/ratnakumar/backups/ncranas_home_bkup/30_032/'), 11, '30_032', TRIM('1400+621    '), 3.667275, 1.0852, 'Tue Apr 26 00:00:02 2016', 1073741823, 3, 0,0, 3.669416, 1.083829, 0.000000, 0.000000, 571935233.000000, 571935233.000000, 0.000000, 0.000000, 0.000000, 0.000000, 4069.010254, -1, -1, 1, 1, 402.652800,spoint(3.667275,1.085200)); 
INSERT INTO das.scans( observation_no, scangroup_id, scan_no, proj_code, source, ra_2000, dec_2000, date_obs, ant_mask, band_mask, calcode, qual, ra_date, dec_date, dra, ddec, sky_freq1, sky_freq2, rest_freq1, rest_freq2, lsr_vel1, lsr_vel2, chan_width, net_sign1, net_sign2, net_sign3, net_sign4, onsrc_time,source_position)VALUES ( 8534, (select scangroup_id from das.scangroup where lta_file='30_032_26apr2016.lta' and observation_no=8534 and file_path='/home/ratnakumar/backups/ncranas_home_bkup/30_032/'), 12, '30_032', TRIM('J1342+5110  '), 3.58842, 0.893087, 'Tue Apr 26 00:00:02 2016', 1073741823, 3, 0,0, 3.591216, 0.891658, 0.000000, 0.000000, 571935233.000000, 571935233.000000, 0.000000, 0.000000, 0.000000, 0.000000, 4069.010254, -1, -1, 1, 1, 2882.994048,spoint(3.588420,0.893087)); 
INSERT INTO das.scans( observation_no, scangroup_id, scan_no, proj_code, source, ra_2000, dec_2000, date_obs, ant_mask, band_mask, calcode, qual, ra_date, dec_date, dra, ddec, sky_freq1, sky_freq2, rest_freq1, rest_freq2, lsr_vel1, lsr_vel2, chan_width, net_sign1, net_sign2, net_sign3, net_sign4, onsrc_time,source_position)VALUES ( 8534, (select scangroup_id from das.scangroup where lta_file='30_032_26apr2016.lta' and observation_no=8534 and file_path='/home/ratnakumar/backups/ncranas_home_bkup/30_032/'), 13, '30_032', TRIM('1400+621    '), 3.667275, 1.0852, 'Tue Apr 26 00:00:02 2016', 1073741823, 3, 0,0, 3.669416, 1.083829, 0.000000, 0.000000, 571935233.000000, 571935233.000000, 0.000000, 0.000000, 0.000000, 0.000000, 4069.010254, -1, -1, 1, 1, 418.758912,spoint(3.667275,1.085200)); 
INSERT INTO das.scans( observation_no, scangroup_id, scan_no, proj_code, source, ra_2000, dec_2000, date_obs, ant_mask, band_mask, calcode, qual, ra_date, dec_date, dra, ddec, sky_freq1, sky_freq2, rest_freq1, rest_freq2, lsr_vel1, lsr_vel2, chan_width, net_sign1, net_sign2, net_sign3, net_sign4, onsrc_time,source_position)VALUES ( 8534, (select scangroup_id from das.scangroup where lta_file='30_032_26apr2016.lta' and observation_no=8534 and file_path='/home/ratnakumar/backups/ncranas_home_bkup/30_032/'), 14, '30_032', TRIM('J1342+5110  '), 3.58842, 0.893087, 'Tue Apr 26 00:00:02 2016', 1073741823, 3, 0,0, 3.591217, 0.891658, 0.000000, 0.000000, 571935233.000000, 571935233.000000, 0.000000, 0.000000, 0.000000, 0.000000, 4069.010254, -1, -1, 1, 1, 2866.887936,spoint(3.588420,0.893087)); 
INSERT INTO das.scans( observation_no, scangroup_id, scan_no, proj_code, source, ra_2000, dec_2000, date_obs, ant_mask, band_mask, calcode, qual, ra_date, dec_date, dra, ddec, sky_freq1, sky_freq2, rest_freq1, rest_freq2, lsr_vel1, lsr_vel2, chan_width, net_sign1, net_sign2, net_sign3, net_sign4, onsrc_time,source_position)VALUES ( 8534, (select scangroup_id from das.scangroup where lta_file='30_032_26apr2016.lta' and observation_no=8534 and file_path='/home/ratnakumar/backups/ncranas_home_bkup/30_032/'), 15, '30_032', TRIM('1400+621    '), 3.667276, 1.085199, 'Tue Apr 26 00:00:02 2016', 1073741823, 3, 0,0, 3.669416, 1.083829, 0.000000, 0.000000, 571935233.000000, 571935233.000000, 0.000000, 0.000000, 0.000000, 0.000000, 4069.010254, -1, -1, 1, 1, 402.652800,spoint(3.667276,1.085199)); 
INSERT INTO das.scans( observation_no, scangroup_id, scan_no, proj_code, source, ra_2000, dec_2000, date_obs, ant_mask, band_mask, calcode, qual, ra_date, dec_date, dra, ddec, sky_freq1, sky_freq2, rest_freq1, rest_freq2, lsr_vel1, lsr_vel2, chan_width, net_sign1, net_sign2, net_sign3, net_sign4, onsrc_time,source_position)VALUES ( 8534, (select scangroup_id from das.scangroup where lta_file='30_032_26apr2016.lta' and observation_no=8534 and file_path='/home/ratnakumar/backups/ncranas_home_bkup/30_032/'), 16, '30_032', TRIM('J1342+5110  '), 3.58842, 0.893087, 'Tue Apr 26 00:00:02 2016', 1073741823, 3, 0,0, 3.591217, 0.891658, 0.000000, 0.000000, 571935233.000000, 571935233.000000, 0.000000, 0.000000, 0.000000, 0.000000, 4069.010254, -1, -1, 1, 1, 2206.537344,spoint(3.588420,0.893087)); 
INSERT INTO das.scans( observation_no, scangroup_id, scan_no, proj_code, source, ra_2000, dec_2000, date_obs, ant_mask, band_mask, calcode, qual, ra_date, dec_date, dra, ddec, sky_freq1, sky_freq2, rest_freq1, rest_freq2, lsr_vel1, lsr_vel2, chan_width, net_sign1, net_sign2, net_sign3, net_sign4, onsrc_time,source_position)VALUES ( 8534, (select scangroup_id from das.scangroup where lta_file='30_032_26apr2016.lta' and observation_no=8534 and file_path='/home/ratnakumar/backups/ncranas_home_bkup/30_032/'), 17, '30_032', TRIM('1400+621    '), 3.667276, 1.085199, 'Tue Apr 26 00:00:02 2016', 1073741823, 3, 0,0, 3.669416, 1.083829, 0.000000, 0.000000, 571935233.000000, 571935233.000000, 0.000000, 0.000000, 0.000000, 0.000000, 4069.010254, -1, -1, 1, 1, 306.016128,spoint(3.667276,1.085199)); 
INSERT INTO das.scans( observation_no, scangroup_id, scan_no, proj_code, source, ra_2000, dec_2000, date_obs, ant_mask, band_mask, calcode, qual, ra_date, dec_date, dra, ddec, sky_freq1, sky_freq2, rest_freq1, rest_freq2, lsr_vel1, lsr_vel2, chan_width, net_sign1, net_sign2, net_sign3, net_sign4, onsrc_time,source_position)VALUES ( 8534, (select scangroup_id from das.scangroup where lta_file='30_032_26apr2016.lta' and observation_no=8534 and file_path='/home/ratnakumar/backups/ncranas_home_bkup/30_032/'), 18, '30_032', TRIM('3C286       '), 3.539258, 0.532485, 'Tue Apr 26 00:00:02 2016', 1073741823, 3, 0,0, 3.542544, 0.531024, 0.000000, 0.000000, 571935233.000000, 571935233.000000, 0.000000, 0.000000, 0.000000, 0.000000, 4069.010254, -1, -1, 1, 1, 692.562816,spoint(3.539258,0.532485)); 

END IF;
END; 
 $$ LANGUAGE PLPGSQL; 
 select parseAndUpdate();